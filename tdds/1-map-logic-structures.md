# 地图逻辑结构

`TDD-1`

---

## 术语解释 {#terms}

以下为此文档会使用到的术语，在后续描述中，不再另行说明。

- `业务实体`：是指在软件系统中用来表示现实世界中具有业务意义的对象或概念的数据结构。
- `本地图`：在此文档中，指《空荧酒馆原神地图》，后续不重复说明。
- `一级地区`：一级地区指的是国家，或者某个分类地图（如海岛、琉形蜃境等）。
- `二级地区`：二级地区指的是提瓦特地图内的某个特定区域（如龙脊雪山、地下矿区等），或某个活动限时地图（如三界路飨祭等）。
- `地区 area`：一级地区、二级地区统称为地区。
- `物品分类 itemType`：是一种致力于清晰、直观、高效地归类游戏内物品的方式。在本地图中，会依据物品特性，将物品归类到以下物品分类中。
  - 宝箱
    - 宝箱品质
    - 获取方式
  - 见闻
  - 特产
  - 矿物
  - 怪物
  - 食材
  - 素材
  - 家园
  - 活动
- `物品 item`：游戏中各种调查物类型（如怪物、采集物、宝箱、可交互物品等）的统称，用以对点位的触发方式和类型进行区分。
- `点位 marker`：游戏中各类可调查物（如怪物、采集物、宝箱、可交互物品等）的标记。

## 逻辑结构关系 {#logic-struct}

此地图中，不同逻辑层级的逻辑结构如下：

``` plantuml
@startuml
' 核心实体定义
[一级地区] as Area1
[二级地区] as Area2
[物品分类] as ItemType
[物品] as Item
[点位] as Marker

' 层级关系（1对多）- 使用实线箭头
Area1 --> Area2 : 1..*
Area2 --> Item : 1..*

' 分类关系（多对多）- 使用双向箭头
ItemType <--> Item : "*..*"

' 分布关系（多对多）- 使用双向箭头
Item <--> Marker : "*..*"
@enduml
```

- 一级地区下包含 **多个** 二级地区。
- 二级地区下包含 **多个** 物品，一个物品 **仅可以** 同时属于一个二级地区。
- 物品分类独立存在，一个物品分类包含 **任意数量** 的物品，一个物品可属于 **多个** 物品分类。
  - 但在大部分情况下，一个物品仅属于 **一个** 物品分类。
- 一个物品可包含 **多个** 点位，一个点位可同时属于 **多个** 物品。

### Q & A {#logic-struct-qa}

- 为什么需要分两层地区？
  - 按国家区分的地区可能存在过大（如须弥）或跨地图（如璃月主图与层岩巨渊）的情况，因此按照地图地块分为两层，以实现更精细的数据归类。
- 为什么不直接将点位数据与地区绑定，而是与地区下的物品进行绑定？
  - 如果跳过物品层级，将地区直接与点位绑定，那么物品层级将会有以下两种处理方案：
    - 方案1：物品也添加与地区的绑定。此方案对物品和点位均添加与地区的绑定，但这两者的绑定并无直接关联，后续需要在程序逻辑中进行二次过滤，降低了数据一致性，增加了代码逻辑的复杂度。
    - 方案2：物品独立存在，直接与点位进行关联。此方案会导致无法对物品进行更精细的过滤，全提瓦特所有的物品均会显示在待选项中，会影响本地图的用户体验。
  - 部分点位确实存在同时属于多个地区的情况。如果直接将点位与地区绑定，在实际使用中，由于点位中并不显示地区信息，因此难以在使用本地图时区分归属地区。在此情况下，地区绑定将缺乏实际意义。
- 为什么物品分类需要独立存在？
  - 若物品分类不独立存在，那么它的实现方案就是：对每个地区绑定一组物品分类。此方案会导致以下一系列问题：
    - 分类数量随着地区数量而膨胀。
    - 在不同地区之间难以保证一致性。
    - 维护成本过高。
    - 由于物品绑定了地区特有的物品分类，难以在不同地区之间进行物品的迁移。
- 为什么一个物品只能绑定一个地区？
  - 若一个物品可绑定到多个地区，那么绑定到这个物品上的点位也属于多个地区。但由于一个点位可以同时属于多个物品，所以在不同地区下增加同名物品，再将点位绑定到这些物品上，是更简洁、逻辑更清晰的做法。在此情况下，并没有让一个物品属于多个地区的必要性。

## 其他说明 {#other-info}

- 关于地区：
  - 尽管地区是参照《原神》中地区划分而来，但与地块边界并没有强制关联的关系。在讨论例如宝箱成就时，会存在跨区域的宝箱。
- 关于物品分类：
  - 通常情况下，宝箱点位至少属于一个【宝箱品质】物品和一个【获取方式】物品。
